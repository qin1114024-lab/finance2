name: Deploy WealthWisdom to GitHub Pages

on:
  push:
    branches:
      - main  # ç•¶ main åˆ†æ”¯æœ‰æ›´æ–°æ™‚è§¸ç™¼

permissions:
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout ğŸ“¥
        uses: actions/checkout@v4

      - name: Setup Node.js âš™ï¸
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install Dependencies ğŸ“¦
        run: |
          if [ -f package.json ]; then
            npm install
          else
            echo "No package.json found, skipping npm install"
          fi

      - name: Build Project ğŸ—ï¸
        run: |
          # é€™è£¡å‡è¨­ä½¿ç”¨ç°¡å–®çš„éœæ…‹æ§‹å»ºï¼Œæˆ–è€…æ‚¨ä¹‹å¾ŒæœƒåŠ å…¥å»ºç½®å·¥å…·å¦‚ Vite
          # ç›®å‰å°ˆæ¡ˆçµæ§‹ç‚ºåŸç”Ÿ ESMï¼Œå¯ä»¥ç›´æ¥é€²è¡Œæª”æ¡ˆæ•´ç†
          mkdir -p dist
          cp index.html dist/
          cp index.tsx dist/
          cp types.ts dist/
          cp constants.tsx dist/
          cp geminiService.ts dist/
          cp -r pages dist/ 2>/dev/null || true
          cp metadata.json dist/
          cp app-blueprint.yaml dist/

      - name: Inject API Key ğŸ”
        run: |
          # é€™æ˜¯ç‚ºäº†åœ¨éœæ…‹ç’°å¢ƒä¸­æ¨¡æ“¬ process.env.API_KEY
          # åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­ï¼Œå»ºè­°é€éå»ºç½®å·¥å…·è™•ç†ç’°å¢ƒè®Šæ•¸
          # é€™è£¡ç¤ºç¯„å°‡ Secrets æ³¨å…¥åˆ°å…¨åŸŸè®Šæ•¸ä¸­
          sed -i 's/process.env.API_KEY/"'${{ secrets.API_KEY }}'"/g' dist/geminiService.ts

      - name: Deploy to GitHub Pages ğŸš€
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist
          force_orphan: true
          publish_branch: gh-pages
